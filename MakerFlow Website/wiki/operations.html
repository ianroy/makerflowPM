<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Wiki | Operations</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&family=Source+Sans+3:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/website/assets/site.css" />
  </head>
  <body class="site-root">
    <header class="site-header">
      <a class="brand-mark" href="/website/">
        <img src="/website/assets/logo.svg" alt="MakerFlow PM logo" />
        <span><strong>MakerFlow PM</strong><em>Operations</em></span>
      </a>
      <nav class="site-nav"><a href="/website/wiki/">Wiki Home</a><a href="/login">App Login</a></nav>
      <div class="site-actions"><a class="btn" href="/login">Launch App</a></div>
    </header>
    <main class="wiki-layout">
      <aside class="wiki-nav">
        <h2>Wiki Pages</h2>
        <a href="/website/wiki/">Overview</a>
        <a href="/website/wiki/getting-started.html">Getting Started</a>
        <a href="/website/wiki/deployment.html">Deployment</a>
        <a href="/website/wiki/architecture.html">Architecture</a>
        <a href="/website/wiki/data-model.html">Data Model</a>
        <a href="/website/wiki/api-routes.html">API and Routes</a>
        <a href="/website/wiki/operations.html" aria-current="page">Operations</a>
        <a href="/website/wiki/file-map.html">Full File Map</a>
        <a href="/website/wiki/release-notes.html">Release Notes</a>
      </aside>
      <article class="wiki-content">
        <h1>Operations Runbook</h1>

        <h2>Monitoring</h2>
        <ul>
          <li>Service status: <code>systemctl status makerflow</code></li>
          <li>Health endpoints: <code>/healthz</code>, <code>/readyz</code></li>
          <li>Review error logs during deploy and auth updates</li>
          <li>Watch DB growth and backup success</li>
        </ul>

        <h2>Backups</h2>
        <p>SQLite path: <code>data/makerspace_ops.db</code></p>
        <pre><code>./scripts/backup_db.sh</code></pre>

        <h2>Security Baseline</h2>
        <ul>
          <li>HTTPS only in production</li>
          <li><code>MAKERSPACE_COOKIE_SECURE=1</code></li>
          <li>Strong <code>MAKERSPACE_SECRET_KEY</code> (64+ chars)</li>
          <li>Rotate bootstrap admin credentials</li>
          <li>Periodic role/access review for workspace admins and owners</li>
        </ul>

        <h2>Operational Troubleshooting</h2>

        <h3>Cannot log in / redirected to login repeatedly</h3>
        <ul>
          <li>Verify session writes are successful in DB logs.</li>
          <li>Verify a stable secret key is configured.</li>
          <li>Confirm secure cookie setting matches HTTPS reality.</li>
        </ul>

        <h3>CSRF token mismatch</h3>
        <ul>
          <li>Clear cookies and re-authenticate.</li>
          <li>Avoid mixed domains/protocols during form posts.</li>
        </ul>

        <h3>500 errors after DB changes</h3>
        <ul>
          <li>Inspect app logs for SQL errors.</li>
          <li>Run bootstrap/migration scripts before serving traffic.</li>
          <li>Confirm PostgreSQL connection URL includes <code>sslmode=require</code>.</li>
        </ul>

        <h2>Post-Release Checklist</h2>
        <ol>
          <li>Run regression and security scripts.</li>
          <li>Update website/wiki docs.</li>
          <li>Verify release notes and file map are current.</li>
        </ol>
      </article>
    </main>
  </body>
</html>
